<include file="Public:header"/>
<include file="Public:menu"/>
<div class="content-wrapper">
    <include file="Public:breadcrumb"/>

    <!-- 主体内容 -->
    <section class="content">
        <div class="row">
            <!-- left column -->
            <div class="col-md-8" style="">
                <!-- general form elements -->
                <div class="box box-solid" style="">
                    <!-- form start -->
                    <form role="form" method="post" action="{:U('User/netbarUpdate')}">
                        <div class="box-body" style="">
                            <div class="form-group"><!-- has-error-->
                                <label>网吧名称<span class="required">*</span></label>
                                <div>
                                    <input name="user_netbar[title]" type="text" placeholder="输入网吧名称 ..."
                                           class="form-control w500 inline-block"
                                           value="{$data[user_netbar][title]}">
                                    <em class="help-block"></em>
                                </div>
                            </div>


                            <div class="form-group">
                                <label>管理员</label>
                                <div>
                                    <input name="real_name" value="{$data[real_name]}" type="text" placeholder=""
                                           class="form-control w500 inline-block">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>手机号码</label>
                                <div>
                                    <input name="tel" value="{$data[tel]}" type="text" placeholder=""
                                           class="form-control w500 inline-block">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>身份证</label>
                                <div>
                                    <input name="identity" value="{$data[identity]}" type="text" placeholder=""
                                           class="form-control w500 inline-block">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>选择地区<span class="required"></span></label>
                                <div id="region">
                                    <select class="form-control w150 inline-block province"
                                            id="province_id" name="province_id">
                                        <option value="">≡ 请选择省 ≡</option>
                                    </select>
                                    <select class="form-control w150 inline-block city"
                                            id="city_id" name="city_id">
                                        <option value="">≡请选择市≡</option>
                                    </select>
                                    <select class="form-control w150 inline-block district"
                                            id="distract_id" name="distract_id">
                                        <option value="">≡ 请选择区 ≡</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>详细地址</label>
                                <div>
                                    <input name="address" value="{$data[address]}" type="text" placeholder=""
                                           class="form-control w500 inline-block">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>支付宝</label>
                                <div>
                                    <input name="alipay" value="{$data[alipay]}" type="text" placeholder=""
                                           class="form-control w500 inline-block">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>银行卡</label>
                                <div>
                                    <input name="bank" value="{$data[bank]}" type="text" placeholder=""
                                           class="form-control w500 inline-block">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>余额</label>
                                <div>
                                    <input name="user_netbar[balance]" value="{$data[user_netbar][balance]}" type="text"
                                           placeholder=""
                                           class="form-control w500 inline-block">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="" class="label_mess">营业执照上传</label>
                                <div class="input-group" style="position: relative; left: 90px; top: -30px;">
                                    <input type="text" placeholder="营业执照上传 ..." readonly="readonly" style="width: 150px;"  class="form-control" id="uiFileUploadInput1" data-thumb="">
                                    <button id="img_ok_1" onclick="upload1()" type="button" class="btn btn-success btn-flat"><i class="fa fw fa-plus-circle"></i></button>
                                    <span style="margin-left: 15px; font-size: 14px; color: #8aa4af">只能上传一张营业执照</span>
                                </div>
                            </div>
                            <div class="form-group" id="new_img_adress">
                                <div>营业执照</div>

                                    <span class='pull-left' style='position:relative;background-color: lightgrey; padding: 10px; margin-left: 5px;'>
                                    <img id="img" style='width: 160px; height: 160px;' src="{$data['license']}"/>
                                    <span style='position: absolute;left: 80px;'>
                                        <span onclick='img_sc(this)'> 删除</span>
                                    </span>
                                        <input type='hidden' name='license' value="{$data['license']}">
                                    </sapn>
                                    </span>

                            </div>
                        </div>

                        <div class="box-footer">
                            <button type="submit" class="btn btn-primary w100">保存</button>
                            <a type="submit" class="btn btn-info w100 ml20"
                               onclick="history.go('-1')">返回</a>
                        </div>

                        <input type="hidden" name="id" value="{$data.id}">
                    </form>

                </div><!-- /.box -->
            </div><!--/.col (left) -->
        </div>
    </section>
    <!-- /.content  -->
</div>

<!-- 上传图片模态框-->
<div class="modal fade " id="imageUploadModal3_3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="">上传营业执照</h4>
            </div>
            <div class="modal-body no-padding maxh500">
                <div class="images-zone tc thumb-place-holder">

                </div>
            </div>
            <div class="modal-footer">
                <div class="pull-left" style="">
                    <div class="btn btn-success fileinput-button pull-left inline-block">
                        <i class="glyphicon glyphicon-plus"></i>
                        <span>添加图片...</span>
                        <input id="fileupload3_3" type="file" name="files[]" multiple="" data-text-control="#uiFileUploadInput1">
                    </div>
                    <span class="loading action-doing hide inline-block mt5 ml10"><i class="fa fa-refresh fa-spin"></i>&nbsp;文件上传中...</span>
                    <span class="loading action-done hide inline-block mt5 ml10" id="text_ok"><i class="fa fa-check-circle-o"></i>&nbsp;上传成功</span>
                </div>
                <button type="button" class="btn btn-default ml20" data-dismiss="modal" id="img_ok">保存</button>
            </div>
        </div>
    </div>
</div>
<!--省市区三级联动-->
<script src="{:ASSETS}plugins/jquery.cityselect.js" type="text/javascript"></script>

<!-- jquery file upload -->
<script src="{:ASSETS}plugins/jquery-file-upload/js/vendor/jquery.ui.widget.js" type="text/javascript"></script>
<script src="{:ASSETS}plugins/jquery-file-upload/js/jquery.fileupload.js" type="text/javascript"></script>
<link href="{:ASSETS}plugins/jquery-file-upload/css/jquery.fileupload.css" rel="stylesheet" type="text/css" />

<!--kind editor-->
<script charset="utf-8" type="text/javascript" src="{:ASSETS}plugins/kindeditor/kindeditor-all-min.js"></script>
<script type="text/javascript">
    $(function (){
        if($.trim($("#img").attr('src')) != ''){
            $("#img_ok_1").attr('disabled','true');
        }
    });
    function img_sc(obj){
        $(obj).parent().parent().slideUp(500,function (){
            $(obj).parent().parent().remove();
            $("#img_ok_1").removeAttr('disabled');
        });
        $("#uiFileUploadInput1").val('');
    }
    $("#img_ok").click(function (){

            var img_adress = $("#uiFileUploadInput1").attr('data-thumb');
            $("#new_img_adress").append(
                  "<span class='pull-left' style='position:relative;background-color: lightgrey; padding: 10px; margin-left: 5px;'><img id='img' style='width: 160px; height: 160px;' src='"+img_adress+"'/> <span style='position: absolute;left: 80px;'> <span onclick='img_sc(this)'> 删除</span> </span> <input type='hidden' name='license' value='"+img_adress+"'> </sapn> </span>");
        $("#img_ok_1").attr('disabled','true');
    });
    //营业执照上传
    function upload1(){
        var img_ok = $("#img_ok");
        img_ok.parent().prev().find('img').attr('src','');
        $("#imageUploadModal3_3").modal({});
    }

    var province = '{$province_id}';
    var city = '{$city_id}';
    var distract = '{$distract_id}';

    province = parseInt(province);
    city = parseInt(city);
    distract = parseInt(distract);

    $(function () {
        //省市区三级联动
        //注意三级联动结构：#region(自定义) > .province + .city + .district
        $("#region").citySelect({
            nodata: "none",
            required: false,
            province:province, //"河南省"
            city:city,
            district: distract,
            url: "{:U('Base/getCity')}",
        });

    });
    var file_url = "{:U('admin/Goods/jqueryFileUpload')}";
    //上传图片
    function show_img(id_1,id_2){
        $(id_1).fileupload({
            //options
            url: file_url,
            dataType: 'json',
            autoUpload: true,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 999000,
            //event
            add: function(e, data) {
                //指定模态框容器
                data.context = $(id_2);
                var autoUpload = $.blueimp.fileupload.prototype.options.autoUpload;
                if (autoUpload) {
                    data.submit();
                    data.context.find(".action-doing").removeClass("hide");
                }
                return true;
            },

            progressall: function(e, data) {
                //进度条
                var progress = parseInt(data.loaded / data.total * 100, 10);
            },

            done: function(e, data) {
                var fileInput = data.fileInput;
                var inputTextId = fileInput.attr("data-text-control");
                var inputText = $(inputTextId);
                var placeHolder = data.context.find(".thumb-place-holder");
                placeHolder.html("");
                $.each(data.result.files, function (index, file) {
                    if (file.thumbnailUrl) {

                        $("<img>").attr("src", file.thumbnailUrl).appendTo(placeHolder);
                        inputText.val(file.url);
                        inputText.attr("data-thumb", file.thumbnailUrl);
                    }
                });
                data.context.find(".action-doing").addClass("hide");
                data.context.find(".action-done").removeClass("hide");
            }
        });
    }
    show_img('#fileupload3_3','#imageUploadModal3_3');
</script>
<include file="Public:footer"/>